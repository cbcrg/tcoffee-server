#{extends 'layout.html' /}
#{set title:'Usage log download' /}

<h1>Log files
<small>
Download the server log files
</small>
</h1>


#{if usageLogFile }
<div class="box">
<h2>
<span>Usage log file</span>
<small><span>The file of request submitted by the users</span></small>
</h2>
 	<img src="@{'/public/images/document.png'}" width="48" height="48" style="float: left; align:bottom"/> 
 	<span style="position:relative; left:1em; ">
 	${usageLogFile} <br/> 
 	<a target="_blank" href="@{Admin.downloadUsageLog}" >Click to donwload</a>
 	</span> 
</div>
#{/if}

#{if appLogFile }
<div class="box">
<h2>
<span>Application log file</span>
<small><span>Contains application level warning and error messages</span> </small>
</h2>

	<img src="@{'/public/images/document.png'}" width="48" height="48" style="float: left; align:bottom"/> 
	<span style="position:relative; left:1em; ">
	${appLogFile} <br/>
	<a target="_blank" href="@{Admin.downloadApplicationLog}" >Click to download</a>
	</span> 
</div>
#{/if}

<div class="box" >
<h2><span>Loggers</span>
<small><span>Manage installed loggers</span></small>
</h2>


<table id="box-table-a">
<thead>
<tr><th>Logger</th><th>Level</th></tr>
</thead>
<tbody>
#{each  loggers }
<tr  >
<td>${_key}</td> <td id="${_key.replaceAll('\\.','|')}" class="cellval">${_value}</td>
</tr>
#{/each}
</tbody>
</table>

<small>In order to change logger level click on the column level, select a new level value and press ENTER to confim, or ESC to cancel.</small>
</div>

<div id="feedback">
</div>

<div class="box-warn" style="display:none">
</div>


*{
 More about the Edit-in-place plugin ()
 http://code.google.com/p/jquery-in-place-editor/
}*
<script type="text/javascript" src="@{'/public/javascripts/jquery.editinplace.js'}" ></script>
<script>

function notifySuccess(level) { 
	$("#feedback").addClass("box-info").text("Logger level updated to " + level) . fadeIn(150) .delay(4000).fadeOut(); 
}

function notifyError(idOfEditor, errorString) { 
	$("#feedback").addClass("box-error").text(errorString) . fadeIn(150) .delay(4000).fadeOut(); 
}

$(document).ready(function(){
	$('.cellval').editInPlace({
		url:"@{Admin.updateLogger}", 
		field_type: "select", 
		select_options: "OFF,FATAL,ERROR,WARN,INFO,DEBUG,TRACE,ALL",
		success: notifySuccess,
		error_sink: notifyError
	})
} )
</script>